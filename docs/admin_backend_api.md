# åå°ç®¡ç†ç³»ç»Ÿ API æ¥å£æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°äº† MasterXiao-AI åå°ç®¡ç†ç³»ç»Ÿçš„æ‰€æœ‰ API æ¥å£ï¼Œæ¶µç›–ç®¡ç†å‘˜è®¤è¯ã€ä»ªè¡¨ç›˜ã€ç”¨æˆ·ç®¡ç†ã€ç®¡ç†å‘˜ç®¡ç†ã€è®¢å•ç®¡ç†ã€æ•°æ®ç®¡ç†ã€åˆ¸ç ç®¡ç†ã€ç³»ç»Ÿç®¡ç†ç­‰æ¨¡å—ã€‚

## åŸºç¡€ä¿¡æ¯

| é¡¹ç›® | è¯´æ˜ |
|---|---|
| **åŸºç¡€ URL** | `http://localhost:3000/api/admin` |
| **è®¤è¯æ–¹å¼** | Bearer Tokenï¼ˆç™»å½•æ¥å£è¿”å›ï¼‰ï¼Œåœ¨è¯·æ±‚å¤´ä¸­ä¼ é€’ `Authorization: Bearer <token>` |
| **å“åº”æ ¼å¼** | JSON |
| **å­—ç¬¦ç¼–ç ** | UTF-8 |

## é€šç”¨å“åº”æ ¼å¼

### æˆåŠŸå“åº”

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {}
}
```

### åˆ†é¡µæ•°æ®å“åº”

```json
{
  "code": 200,
  "data": {
    "list": [],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 100
    }
  }
}
```

### é”™è¯¯å“åº”

```json
{
  "code": 400,
  "message": "é”™è¯¯ä¿¡æ¯æè¿°"
}
```

### é€šç”¨çŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ |
|---|---|
| `200` | è¯·æ±‚æˆåŠŸ |
| `400` | è¯·æ±‚å‚æ•°é”™è¯¯ |
| `401` | æœªè®¤è¯ / è®¤è¯å¤±è´¥ |
| `403` | æƒé™ä¸è¶³ |
| `404` | èµ„æºä¸å­˜åœ¨ |
| `500` | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

---

## ä¸€ã€ç®¡ç†å‘˜è®¤è¯æ¨¡å—

### 1.1 ç®¡ç†å‘˜ç™»å½•

**POST** `/api/admin/login`

> ğŸ”“ æ— éœ€è®¤è¯

**è¯·æ±‚å‚æ•°ï¼ˆBody JSONï¼‰ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|---|---|---|---|
| `username` | string | âœ… | ç®¡ç†å‘˜ç”¨æˆ·å |
| `password` | string | âœ… | ç®¡ç†å‘˜å¯†ç  |

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```json
{
  "username": "admin",
  "password": "admin123"
}
```

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "admin-token-1-1770568707814",
    "admin": {
      "id": 1,
      "username": "admin",
      "is_super_admin": 1
    }
  }
}
```

**é”™è¯¯å“åº”ï¼š**

| åœºæ™¯ | code | message |
|---|---|---|
| ç”¨æˆ·åæˆ–å¯†ç ä¸ºç©º | 400 | ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º |
| ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ | 401 | ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ |
| è´¦å·è¢«ç¦ç”¨ | 403 | è´¦å·å·²è¢«ç¦ç”¨ |

---

### 1.2 è·å–ç®¡ç†å‘˜ä¿¡æ¯

**GET** `/api/admin/profile`

> ğŸ”’ éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°ï¼š** æ— 

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "data": {
    "id": 1,
    "username": "admin",
    "email": "",
    "phone": "",
    "is_super_admin": 1,
    "roles": [
      { "id": 1, "code": "super_admin", "name": "è¶…çº§ç®¡ç†å‘˜" }
    ],
    "permissions": [
      { "id": 1, "code": "system:all", "name": "æ‰€æœ‰æƒé™", "type": "menu" }
    ]
  }
}
```

---

### 1.3 è·å–èœå•åˆ—è¡¨

**GET** `/api/admin/menu`

> ğŸ”’ éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°ï¼š** æ— 

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "code": "dashboard",
      "name": "ä»ªè¡¨ç›˜",
      "type": "menu",
      "icon": "ğŸ“Š",
      "children": []
    },
    {
      "id": 2,
      "code": "user-manage",
      "name": "ç”¨æˆ·ç®¡ç†",
      "type": "menu",
      "icon": "ğŸ‘¥",
      "children": [
        { "id": 21, "code": "user:list", "name": "ç”¨æˆ·åˆ—è¡¨", "type": "menu", "icon": "ğŸ‘¤" }
      ]
    },
    {
      "id": 3,
      "code": "admin-manage",
      "name": "ç®¡ç†å‘˜ç®¡ç†",
      "type": "menu",
      "icon": "ğŸ”‘",
      "children": [
        { "id": 31, "code": "admin:list", "name": "ç®¡ç†å‘˜åˆ—è¡¨", "type": "menu", "icon": "ğŸ‘¨â€ğŸ’¼" }
      ]
    },
    {
      "id": 4,
      "code": "order-manage",
      "name": "è®¢å•ç®¡ç†",
      "type": "menu",
      "icon": "ğŸ“‹",
      "children": [
        { "id": 41, "code": "order:list", "name": "è®¢å•åˆ—è¡¨", "type": "menu", "icon": "ğŸ’°" }
      ]
    },
    {
      "id": 5,
      "code": "data-manage",
      "name": "æ•°æ®ç®¡ç†",
      "type": "menu",
      "icon": "ğŸ“Š",
      "children": [
        { "id": 51, "code": "match:list", "name": "åŒ¹é…è®°å½•", "type": "menu", "icon": "ğŸ”—" }
      ]
    },
    {
      "id": 6,
      "code": "coupon-manage",
      "name": "åˆ¸ç ç®¡ç†",
      "type": "menu",
      "icon": "ğŸ«",
      "children": [
        { "id": 61, "code": "coupon:list", "name": "åˆ¸ç åˆ—è¡¨", "type": "menu", "icon": "ğŸ·ï¸" },
        { "id": 62, "code": "coupon:redeem", "name": "å…‘æ¢è®°å½•", "type": "menu", "icon": "ğŸ“" }
      ]
    },
    {
      "id": 7,
      "code": "system-manage",
      "name": "ç³»ç»Ÿç®¡ç†",
      "type": "menu",
      "icon": "âš™ï¸",
      "children": [
        { "id": 71, "code": "system:question", "name": "é—®é¢˜ç®¡ç†", "type": "menu", "icon": "â“" }
      ]
    }
  ]
}
```

---

## äºŒã€ä»ªè¡¨ç›˜æ¨¡å—

### 2.1 è·å–ä»ªè¡¨ç›˜ç»Ÿè®¡æ•°æ®

**GET** `/api/admin/dashboard/stats`

> ğŸ”’ éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°ï¼š** æ— 

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "data": {
    "totalUsers": 0,
    "totalPayments": 0,
    "totalRevenue": 0,
    "totalMatches": 0,
    "totalCoupons": 5
  }
}
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|---|---|---|
| `totalUsers` | number | æ³¨å†Œç”¨æˆ·æ€»æ•° |
| `totalPayments` | number | è®¢å•æ€»æ•° |
| `totalRevenue` | number | æ€»è¥æ”¶ï¼ˆæˆåŠŸè®¢å•é‡‘é¢ä¹‹å’Œï¼Œç²¾ç¡®åˆ°åˆ†ï¼‰ |
| `totalMatches` | number | å®ŒæˆåŒ¹é…æ€»æ•°ï¼ˆstatus=1ï¼‰ |
| `totalCoupons` | number | åˆ¸ç æ€»æ•° |

---

## ä¸‰ã€ç”¨æˆ·ç®¡ç†æ¨¡å—

### 3.1 è·å–ç”¨æˆ·åˆ—è¡¨

**GET** `/api/admin/users`

> ğŸ”’ éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°ï¼ˆQueryï¼‰ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|---|---|---|---|---|
| `page` | number | å¦ | 1 | å½“å‰é¡µç  |
| `limit` | number | å¦ | 20 | æ¯é¡µæ•°é‡ |
| `keyword` | string | å¦ | - | æœç´¢å…³é”®å­—ï¼ˆåŒ¹é…ç”¨æˆ·åæˆ–æ‰‹æœºå·ï¼‰ |
| `status` | number | å¦ | - | çŠ¶æ€ç­›é€‰ï¼š`1` å¯ç”¨ / `0` ç¦ç”¨ |

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": 1,
        "username": "testuser",
        "phone": "13800138000",
        "email": "test@example.com",
        "role": "user",
        "status": 1,
        "created_at": "2026-02-08 10:00:00",
        "updated_at": "2026-02-08 10:00:00"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 1
    }
  }
}
```

---

### 3.2 ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯

**PUT** `/api/admin/users/:id`

> ğŸ”’ éœ€è¦è®¤è¯

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|---|---|---|
| `id` | number | ç”¨æˆ· ID |

**è¯·æ±‚å‚æ•°ï¼ˆBody JSONï¼‰ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|---|---|---|---|
| `username` | string | å¦ | ç”¨æˆ·å |
| `phone` | string | å¦ | æ‰‹æœºå· |
| `email` | string | å¦ | é‚®ç®± |
| `role` | string | å¦ | è§’è‰² |

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "message": "æ›´æ–°æˆåŠŸ"
}
```

**é”™è¯¯å“åº”ï¼š**

| åœºæ™¯ | code | message |
|---|---|---|
| ç”¨æˆ·ä¸å­˜åœ¨ | 404 | ç”¨æˆ·ä¸å­˜åœ¨ |

---

### 3.3 ä¿®æ”¹ç”¨æˆ·çŠ¶æ€

**PUT** `/api/admin/users/:id/status`

> ğŸ”’ éœ€è¦è®¤è¯

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|---|---|---|
| `id` | number | ç”¨æˆ· ID |

**è¯·æ±‚å‚æ•°ï¼ˆBody JSONï¼‰ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|---|---|---|---|
| `status` | boolean | âœ… | `true` å¯ç”¨ / `false` ç¦ç”¨ |

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "message": "å·²å¯ç”¨"
}
```

**é”™è¯¯å“åº”ï¼š**

| åœºæ™¯ | code | message |
|---|---|---|
| ç”¨æˆ·ä¸å­˜åœ¨ | 404 | ç”¨æˆ·ä¸å­˜åœ¨ |

---

## å››ã€ç®¡ç†å‘˜ç®¡ç†æ¨¡å—

### 4.1 è·å–ç®¡ç†å‘˜åˆ—è¡¨

**GET** `/api/admin/admins`

> ğŸ”’ éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°ï¼ˆQueryï¼‰ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|---|---|---|---|---|
| `page` | number | å¦ | 1 | å½“å‰é¡µç  |
| `limit` | number | å¦ | 20 | æ¯é¡µæ•°é‡ |

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": 1,
        "username": "admin",
        "email": null,
        "phone": null,
        "is_super_admin": 1,
        "status": 1,
        "last_login_at": "2026-02-09T01:00:00.000Z",
        "created_at": "2026-02-08 10:00:00"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 1
    }
  }
}
```

---

### 4.2 æ–°å¢ç®¡ç†å‘˜

**POST** `/api/admin/admins`

> ğŸ”’ éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°ï¼ˆBody JSONï¼‰ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|---|---|---|---|
| `username` | string | âœ… | ç®¡ç†å‘˜ç”¨æˆ·å |
| `password` | string | âœ… | ç®¡ç†å‘˜å¯†ç  |
| `email` | string | å¦ | é‚®ç®± |
| `phone` | string | å¦ | æ‰‹æœºå· |

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```json
{
  "username": "editor",
  "password": "editor123",
  "email": "editor@example.com",
  "phone": "13900139000"
}
```

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "message": "åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 2,
    "username": "editor"
  }
}
```

**é”™è¯¯å“åº”ï¼š**

| åœºæ™¯ | code | message |
|---|---|---|
| ç”¨æˆ·åæˆ–å¯†ç ä¸ºç©º | 400 | ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º |
| ç”¨æˆ·åå·²å­˜åœ¨ | 400 | ç”¨æˆ·åå·²å­˜åœ¨ |

---

### 4.3 ç¼–è¾‘ç®¡ç†å‘˜

**PUT** `/api/admin/admins/:id`

> ğŸ”’ éœ€è¦è®¤è¯

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|---|---|---|
| `id` | number | ç®¡ç†å‘˜ ID |

**è¯·æ±‚å‚æ•°ï¼ˆBody JSONï¼‰ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|---|---|---|---|
| `username` | string | å¦ | ç”¨æˆ·å |
| `email` | string | å¦ | é‚®ç®± |
| `phone` | string | å¦ | æ‰‹æœºå· |
| `password` | string | å¦ | æ–°å¯†ç ï¼ˆä¼ å…¥åˆ™é‡ç½®å¯†ç ï¼‰ |

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "message": "æ›´æ–°æˆåŠŸ"
}
```

**é”™è¯¯å“åº”ï¼š**

| åœºæ™¯ | code | message |
|---|---|---|
| ç®¡ç†å‘˜ä¸å­˜åœ¨ | 404 | ç®¡ç†å‘˜ä¸å­˜åœ¨ |

---

### 4.4 ä¿®æ”¹ç®¡ç†å‘˜çŠ¶æ€

**PUT** `/api/admin/admins/:id/status`

> ğŸ”’ éœ€è¦è®¤è¯

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|---|---|---|
| `id` | number | ç®¡ç†å‘˜ ID |

**è¯·æ±‚å‚æ•°ï¼ˆBody JSONï¼‰ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|---|---|---|---|
| `status` | boolean | âœ… | `true` å¯ç”¨ / `false` ç¦ç”¨ |

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "message": "å·²å¯ç”¨"
}
```

**é”™è¯¯å“åº”ï¼š**

| åœºæ™¯ | code | message |
|---|---|---|
| ç®¡ç†å‘˜ä¸å­˜åœ¨ | 404 | ç®¡ç†å‘˜ä¸å­˜åœ¨ |
| è¶…çº§ç®¡ç†å‘˜ä¿æŠ¤ | 403 | ä¸èƒ½åœç”¨è¶…çº§ç®¡ç†å‘˜ |

---

## äº”ã€è®¢å•ç®¡ç†æ¨¡å—

### 5.1 è·å–è®¢å•åˆ—è¡¨

**GET** `/api/admin/orders`

> ğŸ”’ éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°ï¼ˆQueryï¼‰ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|---|---|---|---|---|
| `page` | number | å¦ | 1 | å½“å‰é¡µç  |
| `limit` | number | å¦ | 20 | æ¯é¡µæ•°é‡ |
| `keyword` | string | å¦ | - | æœç´¢å…³é”®å­—ï¼ˆåŒ¹é…è®¢å•å·æˆ–ç”¨æˆ·åï¼‰ |
| `status` | string | å¦ | - | è®¢å•çŠ¶æ€ç­›é€‰ï¼š`pending` å¾…æ”¯ä»˜ / `success` å·²æ”¯ä»˜ / `failed` å·²å¤±è´¥ / `refunded` å·²é€€æ¬¾ |

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": 1,
        "user_id": 1,
        "order_no": "ORD202602080001",
        "amount": 9.90,
        "status": "success",
        "payment_method": "wechat",
        "created_at": "2026-02-08 12:00:00",
        "paid_at": "2026-02-08 12:01:00",
        "user_name": "testuser"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 1
    }
  }
}
```

---

## å…­ã€æ•°æ®ç®¡ç†æ¨¡å—ï¼ˆåŒ¹é…è®°å½•ï¼‰

### 6.1 è·å–åŒ¹é…è®°å½•åˆ—è¡¨

**GET** `/api/admin/match-records`

> ğŸ”’ éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°ï¼ˆQueryï¼‰ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|---|---|---|---|---|
| `page` | number | å¦ | 1 | å½“å‰é¡µç  |
| `limit` | number | å¦ | 20 | æ¯é¡µæ•°é‡ |
| `status` | number | å¦ | - | çŠ¶æ€ç­›é€‰ï¼š`1` å·²å®Œæˆ / `0` è¿›è¡Œä¸­ |

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": 1,
        "session_id": "sess_abc123",
        "user_id": "1",
        "match_type": "tarot",
        "status": 1,
        "req_data": { "question": "ä»Šæ—¥è¿åŠ¿" },
        "result_data": { "card": "æ„šè€…", "meaning": "æ–°çš„å¼€å§‹" },
        "create_date": "2026-02-08 14:00:00",
        "user_name": "testuser"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 1
    }
  }
}
```

> **æ³¨æ„ï¼š** `req_data` å’Œ `result_data` å­—æ®µåŸå§‹å­˜å‚¨ä¸º JSON å­—ç¬¦ä¸²ï¼Œæ¥å£ä¼šè‡ªåŠ¨è§£æä¸ºå¯¹è±¡è¿”å›ã€‚

---

### 6.2 è·å–åŒ¹é…è®°å½•è¯¦æƒ…

**GET** `/api/admin/match-records/:id`

> ğŸ”’ éœ€è¦è®¤è¯

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|---|---|---|
| `id` | number | è®°å½• ID |

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "data": {
    "id": 1,
    "session_id": "sess_abc123",
    "user_id": "1",
    "match_type": "tarot",
    "status": 1,
    "req_data": { "question": "ä»Šæ—¥è¿åŠ¿" },
    "result_data": { "card": "æ„šè€…", "meaning": "æ–°çš„å¼€å§‹" },
    "create_date": "2026-02-08 14:00:00",
    "user_name": "testuser"
  }
}
```

**é”™è¯¯å“åº”ï¼š**

| åœºæ™¯ | code | message |
|---|---|---|
| è®°å½•ä¸å­˜åœ¨ | 404 | è®°å½•ä¸å­˜åœ¨ |

---

## ä¸ƒã€åˆ¸ç ç®¡ç†æ¨¡å—

### 7.1 è·å–åˆ¸ç åˆ—è¡¨

**GET** `/api/admin/coupons`

> ğŸ”’ éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°ï¼ˆQueryï¼‰ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|---|---|---|---|---|
| `page` | number | å¦ | 1 | å½“å‰é¡µç  |
| `limit` | number | å¦ | 20 | æ¯é¡µæ•°é‡ |
| `status` | string | å¦ | - | çŠ¶æ€ç­›é€‰ï¼š`active` å¯ç”¨ / `used` å·²ä½¿ç”¨ / `expired` å·²è¿‡æœŸ / `disabled` å·²ç¦ç”¨ |
| `type` | string | å¦ | - | ç±»å‹ç­›é€‰ï¼š`single` å•æ¬¡ä½¿ç”¨ / `multi` å¤šæ¬¡ä½¿ç”¨ |

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": 1,
        "code": "ABCD-1234-EFGH",
        "type": "single",
        "status": "active",
        "max_uses": 1,
        "used_count": 0,
        "source": "admin",
        "remark": null,
        "created_at": "2026-02-08 10:00:00",
        "updated_at": "2026-02-08 10:00:00"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 5
    }
  }
}
```

---

### 7.2 æ‰¹é‡ç”Ÿæˆåˆ¸ç 

**POST** `/api/admin/coupons/generate`

> ğŸ”’ éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°ï¼ˆBody JSONï¼‰ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|---|---|---|---|---|
| `type` | string | å¦ | `single` | åˆ¸ç ç±»å‹ï¼š`single` å•æ¬¡ / `multi` å¤šæ¬¡ |
| `max_uses` | number | å¦ | 1 | æœ€å¤§ä½¿ç”¨æ¬¡æ•°ï¼ˆä»… `multi` ç±»å‹æœ‰æ•ˆï¼ŒèŒƒå›´ 1-100ï¼‰ |
| `count` | number | å¦ | 1 | ç”Ÿæˆæ•°é‡ï¼ˆèŒƒå›´ 1-100ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```json
{
  "type": "single",
  "count": 10
}
```

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "message": "æˆåŠŸç”Ÿæˆ 10 ä¸ªåˆ¸ç ",
  "data": [
    {
      "id": 6,
      "code": "ABCD-1234-EFGH",
      "type": "single",
      "max_uses": 1,
      "status": "active"
    }
  ]
}
```

**é”™è¯¯å“åº”ï¼š**

| åœºæ™¯ | code | message |
|---|---|---|
| æ•°é‡ä¸åœ¨ 1-100 èŒƒå›´ | 400 | æ•°é‡å¿…é¡»åœ¨1-100ä¹‹é—´ |
| multi ç±»å‹æ¬¡æ•°ä¸åˆæ³• | 400 | ä½¿ç”¨æ¬¡æ•°å¿…é¡»åœ¨1-100ä¹‹é—´ |

---

### 7.3 ç¼–è¾‘åˆ¸ç 

**PUT** `/api/admin/coupons/:id`

> ğŸ”’ éœ€è¦è®¤è¯

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|---|---|---|
| `id` | number | åˆ¸ç  ID |

**è¯·æ±‚å‚æ•°ï¼ˆBody JSONï¼‰ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|---|---|---|---|
| `type` | string | å¦ | åˆ¸ç ç±»å‹ |
| `max_uses` | number | å¦ | æœ€å¤§ä½¿ç”¨æ¬¡æ•° |
| `status` | string | å¦ | çŠ¶æ€ï¼š`active` / `disabled` ç­‰ |
| `remark` | string | å¦ | å¤‡æ³¨ |

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "message": "æ›´æ–°æˆåŠŸ"
}
```

**é”™è¯¯å“åº”ï¼š**

| åœºæ™¯ | code | message |
|---|---|---|
| åˆ¸ç ä¸å­˜åœ¨ | 404 | åˆ¸ç ä¸å­˜åœ¨ |

---

### 7.4 è·å–å…‘æ¢è®°å½•

**GET** `/api/admin/coupons/redeem-records`

> ğŸ”’ éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°ï¼ˆQueryï¼‰ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|---|---|---|---|---|
| `page` | number | å¦ | 1 | å½“å‰é¡µç  |
| `limit` | number | å¦ | 20 | æ¯é¡µæ•°é‡ |

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": 1,
        "code": "ABCD-1234-EFGH",
        "type": "single",
        "status": "used",
        "max_uses": 1,
        "used_count": 1,
        "source": "admin",
        "created_at": "2026-02-08 10:00:00",
        "updated_at": "2026-02-08 15:30:00"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 1
    }
  }
}
```

> **è¯´æ˜ï¼š** åªè¿”å› `used_count > 0` çš„åˆ¸ç è®°å½•ã€‚

---

## å…«ã€ç³»ç»Ÿç®¡ç†æ¨¡å—ï¼ˆé—®é¢˜ç®¡ç†ï¼‰

### 8.1 è·å–é—®é¢˜åˆ—è¡¨

**GET** `/api/admin/questions`

> ğŸ”’ éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°ï¼ˆQueryï¼‰ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|---|---|---|---|---|
| `page` | number | å¦ | 1 | å½“å‰é¡µç  |
| `limit` | number | å¦ | 20 | æ¯é¡µæ•°é‡ |
| `category` | string | å¦ | - | åˆ†ç±»ç­›é€‰ï¼š`general` é€šç”¨ / `tarot` å¡”ç½— / `birthday` ç”Ÿæ—¥ / `liuyao` å…­çˆ» / `bazi` å…«å­— |
| `status` | number | å¦ | - | çŠ¶æ€ç­›é€‰ï¼š`1` å¯ç”¨ / `0` ç¦ç”¨ |
| `keyword` | string | å¦ | - | æœç´¢å…³é”®å­—ï¼ˆåŒ¹é…æ ‡é¢˜æˆ–å†…å®¹ï¼‰ |

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": 1,
        "title": "ä»Šæ—¥è¿åŠ¿å¦‚ä½•ï¼Ÿ",
        "content": "è¯·ä¸ºæˆ‘è§£è¯»ä»Šæ—¥çš„æ•´ä½“è¿åŠ¿",
        "category": "tarot",
        "sort_order": 1,
        "status": 1,
        "created_by": 1,
        "created_at": "2026-02-09 10:00:00",
        "updated_at": "2026-02-09 10:00:00"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 1
    }
  }
}
```

---

### 8.2 è·å–é—®é¢˜è¯¦æƒ…

**GET** `/api/admin/questions/:id`

> ğŸ”’ éœ€è¦è®¤è¯

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|---|---|---|
| `id` | number | é—®é¢˜ ID |

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "data": {
    "id": 1,
    "title": "ä»Šæ—¥è¿åŠ¿å¦‚ä½•ï¼Ÿ",
    "content": "è¯·ä¸ºæˆ‘è§£è¯»ä»Šæ—¥çš„æ•´ä½“è¿åŠ¿",
    "category": "tarot",
    "sort_order": 1,
    "status": 1,
    "created_by": 1,
    "created_at": "2026-02-09 10:00:00",
    "updated_at": "2026-02-09 10:00:00"
  }
}
```

**é”™è¯¯å“åº”ï¼š**

| åœºæ™¯ | code | message |
|---|---|---|
| é—®é¢˜ä¸å­˜åœ¨ | 404 | é—®é¢˜ä¸å­˜åœ¨ |

---

### 8.3 æ–°å¢é—®é¢˜

**POST** `/api/admin/questions`

> ğŸ”’ éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°ï¼ˆBody JSONï¼‰ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|---|---|---|---|---|
| `title` | string | âœ… | - | é—®é¢˜æ ‡é¢˜ |
| `content` | string | å¦ | `""` | é—®é¢˜å†…å®¹ |
| `category` | string | å¦ | `general` | åˆ†ç±»ï¼š`general` / `tarot` / `birthday` / `liuyao` / `bazi` |
| `sort_order` | number | å¦ | 0 | æ’åºåºå·ï¼ˆè¶Šå°è¶Šé å‰ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```json
{
  "title": "ä»Šæ—¥è¿åŠ¿å¦‚ä½•ï¼Ÿ",
  "content": "è¯·ä¸ºæˆ‘è§£è¯»ä»Šæ—¥çš„æ•´ä½“è¿åŠ¿",
  "category": "tarot",
  "sort_order": 1
}
```

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "message": "åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 1,
    "title": "ä»Šæ—¥è¿åŠ¿å¦‚ä½•ï¼Ÿ",
    "content": "è¯·ä¸ºæˆ‘è§£è¯»ä»Šæ—¥çš„æ•´ä½“è¿åŠ¿",
    "category": "tarot",
    "sort_order": 1,
    "status": 1
  }
}
```

**é”™è¯¯å“åº”ï¼š**

| åœºæ™¯ | code | message |
|---|---|---|
| æ ‡é¢˜ä¸ºç©º | 400 | æ ‡é¢˜ä¸èƒ½ä¸ºç©º |

---

### 8.4 ç¼–è¾‘é—®é¢˜

**PUT** `/api/admin/questions/:id`

> ğŸ”’ éœ€è¦è®¤è¯

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|---|---|---|
| `id` | number | é—®é¢˜ ID |

**è¯·æ±‚å‚æ•°ï¼ˆBody JSONï¼‰ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|---|---|---|---|
| `title` | string | å¦ | é—®é¢˜æ ‡é¢˜ |
| `content` | string | å¦ | é—®é¢˜å†…å®¹ |
| `category` | string | å¦ | åˆ†ç±» |
| `status` | number | å¦ | çŠ¶æ€ï¼š`1` å¯ç”¨ / `0` ç¦ç”¨ |
| `sort_order` | number | å¦ | æ’åºåºå· |

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "message": "æ›´æ–°æˆåŠŸ"
}
```

**é”™è¯¯å“åº”ï¼š**

| åœºæ™¯ | code | message |
|---|---|---|
| é—®é¢˜ä¸å­˜åœ¨ | 404 | é—®é¢˜ä¸å­˜åœ¨ |

---

### 8.5 åˆ é™¤é—®é¢˜

**DELETE** `/api/admin/questions/:id`

> ğŸ”’ éœ€è¦è®¤è¯

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|---|---|---|
| `id` | number | é—®é¢˜ ID |

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "message": "åˆ é™¤æˆåŠŸ"
}
```

**é”™è¯¯å“åº”ï¼š**

| åœºæ™¯ | code | message |
|---|---|---|
| é—®é¢˜ä¸å­˜åœ¨ | 404 | é—®é¢˜ä¸å­˜åœ¨ |

---

## ä¹ã€å…¼å®¹æ¥å£

### 9.1 è·å–è§’è‰²åˆ—è¡¨

**GET** `/api/admin/roles`

> ğŸ”’ éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°ï¼š** æ— 

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "code": "super_admin",
      "name": "è¶…çº§ç®¡ç†å‘˜",
      "description": "æ‹¥æœ‰æ‰€æœ‰æƒé™",
      "status": 1,
      "created_at": "2026-02-08 10:00:00"
    }
  ]
}
```

---

### 9.2 è·å–æƒé™åˆ—è¡¨

**GET** `/api/admin/permissions`

> ğŸ”’ éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°ï¼š** æ— 

**æˆåŠŸå“åº”ï¼š**

```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": 1,
        "code": "system:all",
        "name": "æ‰€æœ‰æƒé™",
        "type": "menu",
        "parent_id": null,
        "status": 1
      }
    ],
    "tree": []
  }
}
```

---

## æ¥å£æ€»è§ˆ

| åºå· | æ–¹æ³• | æ¥å£è·¯å¾„ | è¯´æ˜ | è®¤è¯ |
|---|---|---|---|---|
| 1 | POST | `/api/admin/login` | ç®¡ç†å‘˜ç™»å½• | âŒ |
| 2 | GET | `/api/admin/profile` | è·å–ç®¡ç†å‘˜ä¿¡æ¯ | âœ… |
| 3 | GET | `/api/admin/menu` | è·å–èœå•åˆ—è¡¨ | âœ… |
| 4 | GET | `/api/admin/dashboard/stats` | ä»ªè¡¨ç›˜ç»Ÿè®¡ | âœ… |
| 5 | GET | `/api/admin/users` | ç”¨æˆ·åˆ—è¡¨ | âœ… |
| 6 | PUT | `/api/admin/users/:id` | ç¼–è¾‘ç”¨æˆ· | âœ… |
| 7 | PUT | `/api/admin/users/:id/status` | ä¿®æ”¹ç”¨æˆ·çŠ¶æ€ | âœ… |
| 8 | GET | `/api/admin/admins` | ç®¡ç†å‘˜åˆ—è¡¨ | âœ… |
| 9 | POST | `/api/admin/admins` | æ–°å¢ç®¡ç†å‘˜ | âœ… |
| 10 | PUT | `/api/admin/admins/:id` | ç¼–è¾‘ç®¡ç†å‘˜ | âœ… |
| 11 | PUT | `/api/admin/admins/:id/status` | ä¿®æ”¹ç®¡ç†å‘˜çŠ¶æ€ | âœ… |
| 12 | GET | `/api/admin/orders` | è®¢å•åˆ—è¡¨ | âœ… |
| 13 | GET | `/api/admin/match-records` | åŒ¹é…è®°å½•åˆ—è¡¨ | âœ… |
| 14 | GET | `/api/admin/match-records/:id` | åŒ¹é…è®°å½•è¯¦æƒ… | âœ… |
| 15 | GET | `/api/admin/coupons` | åˆ¸ç åˆ—è¡¨ | âœ… |
| 16 | POST | `/api/admin/coupons/generate` | æ‰¹é‡ç”Ÿæˆåˆ¸ç  | âœ… |
| 17 | PUT | `/api/admin/coupons/:id` | ç¼–è¾‘åˆ¸ç  | âœ… |
| 18 | GET | `/api/admin/coupons/redeem-records` | å…‘æ¢è®°å½• | âœ… |
| 19 | GET | `/api/admin/questions` | é—®é¢˜åˆ—è¡¨ | âœ… |
| 20 | GET | `/api/admin/questions/:id` | é—®é¢˜è¯¦æƒ… | âœ… |
| 21 | POST | `/api/admin/questions` | æ–°å¢é—®é¢˜ | âœ… |
| 22 | PUT | `/api/admin/questions/:id` | ç¼–è¾‘é—®é¢˜ | âœ… |
| 23 | DELETE | `/api/admin/questions/:id` | åˆ é™¤é—®é¢˜ | âœ… |
| 24 | GET | `/api/admin/roles` | è§’è‰²åˆ—è¡¨ | âœ… |
| 25 | GET | `/api/admin/permissions` | æƒé™åˆ—è¡¨ | âœ… |

---

## å‰ç«¯é¡µé¢

åå°ç®¡ç†å‰ç«¯é¡µé¢ä½äº `web/backend/` ç›®å½•ï¼š

| æ–‡ä»¶ | è¯´æ˜ |
|---|---|
| `login.html` | ç®¡ç†å‘˜ç™»å½•é¡µ |
| `index.html` | ç®¡ç†åå°ä¸»é¡µï¼ˆå«æ‰€æœ‰åŠŸèƒ½æ¨¡å—ï¼‰ |
| `css/login.css` | ç™»å½•é¡µæ ·å¼ |
| `css/admin.css` | åå°ä¸»é¡µæ ·å¼ |
| `js/login.js` | ç™»å½•é¡µé€»è¾‘ |
| `js/admin.js` | åå°ä¸»é¡µé€»è¾‘ï¼ˆèœå•ã€CRUDã€å¼¹çª—ç­‰ï¼‰ |

---

*æ–‡æ¡£æœ€åæ›´æ–°ï¼š2026-02-09*
